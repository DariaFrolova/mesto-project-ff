(()=>{"use strict";var e=document.querySelector("#card-template").content.querySelector(".card"),t=function(e,t,n,r,o){e.classList.contains("card__like-button_is-active")?o(t).then((function(t){e.classList.remove("card__like-button_is-active"),n.textContent=t.likes.length})).catch((function(e){console.error(e)})):r(t).then((function(t){e.classList.add("card__like-button_is-active"),n.textContent=t.likes.length})).catch((function(e){console.error(e)}))},n=function(t,n,r,o,c,u,a,i){var s=e.cloneNode(!0),l=s.querySelector(".card__image"),d=s.querySelector(".card__title"),p=s.querySelector(".card__delete-button"),f=s.querySelector(".card__like-button"),_=s.querySelector(".card__like-number");return l.src=t.link,l.alt=t.name,d.textContent=t.name,_.textContent=t.likes.length,t.owner._id===c?p.classList.remove("card__delete-button-hide"):p.classList.add("card__delete-button-hide"),p.addEventListener("click",(function(){i(t._id).then((function(){s.remove()})).catch((function(e){console.error(e)}))})),f.addEventListener("click",(function(){r(f,t._id,_,u,a)})),t.likes.some((function(e){return e._id===c}))&&f.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(){o(t.link,t.name)})),s},r=function(e){document.addEventListener("keydown",c),e.classList.add("popup_is-opened")},o=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)},c=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&o(t)}},u=function(e,t,n,r){var o=r.inputErrorClass,c=r.errorClass,u=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),u.textContent=n,u.classList.add(c)},a=function(e,t,n){var r=n.inputErrorClass,o=n.errorClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r),c.textContent="",c.classList.remove(o)},i=function(e,t,n){var r=function(e){return e.some((function(e){return!e.validity.valid}))}(t);n.disabled=r,n.classList.toggle(e.inactiveButtonClass,r)},s=function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);r.disabled=!0,r.classList.add(e.inactiveButtonClass),n.forEach((function(n){a(t,n,e)}))},l={baseUrl:"https://nomoreparties.co/v1/wff-cohort-7",headers:{authorization:"58e6624f-a0fc-46a5-949f-6be2e96427b3","Content-Type":"application/json"}},d=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},p=function(e){return fetch("".concat(l.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return d(e)}))},f=function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then((function(e){return d(e)}))},_=function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return d(e)}))},m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},v=document.querySelector(".profile__title"),y=document.querySelector(".profile__description"),h=document.querySelector(".profile__image"),b=document.querySelector(".popup_type_edit"),S=b.querySelector(".popup__input_type_name"),q=b.querySelector(".popup__input_type_description"),L=document.querySelector(".popup_type_edit-avatar"),k=document.querySelector(".popup__input_type_avatar-url"),E=document.querySelectorAll(".popup"),C=b.querySelector(".popup__form"),g=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__edit-button"),U=document.querySelector(".places__list"),A=document.querySelector(".popup_type_image"),T=A.querySelector(".popup__image"),w=A.querySelector(".popup__caption"),B=document.querySelector(".popup_type_new-card"),D=document.querySelector(".popup__input_type_card-name"),P=document.querySelector(".popup__input_type_url"),N=document.querySelector("form[name='new-place']"),O="",j="";Promise.all([fetch("".concat(l.baseUrl,"/cards"),{method:"GET",headers:l.headers}).then((function(e){return d(e)})),fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then((function(e){return d(e)}))]).then((function(e){O=e[1]._id,v.textContent=e[1].name,y.textContent=e[1].about,h.style.backgroundImage="url('".concat(e[1].avatar,"')"),e[0].forEach((function(e){var r=n(e,0,t,H,O,f,_,p);U.append(r)}))})).catch((function(e){console.log(e)}));var J=function(e,t){t.textContent=e?"Сохранение...":j};g.addEventListener("click",(function(){D.value="",P.value="";var e=B,t=e.querySelector("form");t&&(s(m,t),j=e.querySelector(".popup__button").textContent),r(B)}));var H=function(e,t){T.src=e,T.alt=t,w.textContent=t,r(A)};h.addEventListener("click",(function(){var e=L,t=e.querySelector("form");t&&(s(m,t),k.value="",j=e.querySelector(".popup__button").textContent),r(L)})),x.addEventListener("click",(function(){var e=b.querySelector("form");S.value=v.textContent,q.value=y.textContent,e&&(s(m,e),j=b.querySelector(".popup__button").textContent),r(b)})),C.addEventListener("submit",(function(e){var t,n;e.preventDefault(),J(!0,e.submitter),(t=S.value,n=q.value,fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return d(e)}))).then((function(e){v.textContent=e.name,y.textContent=e.about,o(b)})).catch((function(e){console.error(e)})).finally((function(){J(!1,e.submitter)}))})),N.addEventListener("submit",(function(e){e.preventDefault(),J(!0,e.submitter);var r,c,u={name:D.value,link:P.value};(r=u.name,c=u.link,fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:r,link:c})}).then((function(e){return d(e)}))).then((function(e){var r=n(e,0,t,H,O,f,_,p);U.prepend(r),o(B),N.reset()})).catch((function(e){console.error(e)})).finally((function(){J(!1,e.submitter)}))})),L.addEventListener("submit",(function(e){e.preventDefault();var t,n=k.value;J(!0,e.submitter),(t=n,fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then((function(e){return d(e)}))).then((function(e){h.style.backgroundImage="url('".concat(e.avatar,"')"),o(L)})).catch((function(e){console.error(e)})).finally((function(){J(!1,e.submitter)}))})),E.forEach((function(e){var t=function(e){return function(t){(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&o(e)}}(e);e.addEventListener("click",t)})),function(e){document.querySelectorAll(e.formSelector).forEach((function(t){var n=t.querySelector(e.submitButtonSelector),r=Array.from(t.querySelectorAll(e.inputSelector));r.forEach((function(o){o.addEventListener("input",(function(){(function(e,t,n){if(t.validity.valid)a(e,t,n);else if(t.validity.patternMismatch){var r=t.getAttribute("data-error-message");u(e,t,r,n)}else{var o=t.validationMessage;u(e,t,o,n)}})(t,o,e),i(e,r,n)}))})),t.addEventListener("submit",(function(e){e.preventDefault()})),i(e,r,n)}))}(m)})();