(()=>{"use strict";var e=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)},t=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)},n=function(e){if("Escape"===e.key){var n=document.querySelector(".popup_is-opened");n&&t(n)}},r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-7",headers:{authorization:"58e6624f-a0fc-46a5-949f-6be2e96427b3","Content-Type":"application/json"}},o=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},c=document.querySelector("#card-template").content.querySelector(".card"),u=function(e,t,n){e.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return o(e)}))}(t).then((function(t){e.classList.remove("card__like-button_is-active"),n.textContent=t.likes.length})).catch((function(e){console.error(e)})):function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then((function(e){return o(e)}))}(t).then((function(t){e.classList.add("card__like-button_is-active"),n.textContent=t.likes.length})).catch((function(e){console.error(e)}))},a=function(e,t){(function(e){return fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return o(e)}))})(t).then((function(){e.remove()})).catch((function(e){console.error(e)}))},i=function(e,t,n,r,o){var u=c.cloneNode(!0),a=u.querySelector(".card__image"),i=u.querySelector(".card__title"),s=u.querySelector(".card__delete-button"),l=u.querySelector(".card__like-button"),d=u.querySelector(".card__like-number");return a.src=e.link,a.alt=e.name,i.textContent=e.name,d.textContent=e.likes.length,l.addEventListener("click",(function(){n(l,e._id,d)})),e.likes.some((function(e){return e._id===o}))&&l.classList.add("card__like-button_is-active"),a.addEventListener("click",(function(){r(e.link,e.name)})),e.owner._id===o&&(s.style.display="block",s.addEventListener("click",(function(){t(u,e._id)}))),u},s=function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)},l=function(e,t,n){var r=function(e){return e.some((function(e){return!e.validity.valid}))}(t);n.disabled=r,n.classList.toggle(e.inactiveButtonClass,r)},d=function(e,t,n){var r=Array.from(t.querySelectorAll(e.inputSelector));l(e,r,n),r.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){if(t.validity.valid)!function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass)}(e,t,n);else if(t.validity.patternMismatch){var r=t.getAttribute("data-error-message");s(e,t,r,n)}else{var o=t.validationMessage;s(e,t,o,n)}var c=t.closest(n.formSelector),u=Array.from(c.querySelectorAll(n.inputSelector)),a=c.querySelector(n.submitButtonSelector);l(n,u,a)}(t,n,e)}))}))},p=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),_=document.querySelector(".profile__image"),m=document.querySelector(".popup_type_edit"),v=m.querySelector(".popup__input_type_name"),y=m.querySelector(".popup__input_type_description"),h=document.querySelector(".popup_type_edit-avatar"),b=document.querySelector(".popup__input_type_avatar-url"),S=document.querySelectorAll(".popup"),q=m.querySelector(".popup__form"),k=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__edit-button"),L=document.querySelector(".places__list"),C=document.querySelector(".popup_type_image"),g=C.querySelector(".popup__image"),x=C.querySelector(".popup__caption"),A=document.querySelector(".popup_type_new-card"),T=document.querySelector(".popup__input_type_card-name"),U=document.querySelector(".popup__input_type_url"),w=document.querySelector("form[name='new-place']");Promise.all([fetch("".concat(r.baseUrl,"/cards"),{method:"GET",headers:r.headers}).then((function(e){return o(e)})),fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return o(e)}))]).then((function(e){var t=e[1]._id;p.textContent=e[1].name,f.textContent=e[1].about,_.style.backgroundImage="url('".concat(e[1].avatar,"')"),e[0].forEach((function(e){var n=i(e,a,u,P,t);L.append(n)}))})).catch((function(e){console.log(e)}));var B,D=function(e,t){t.textContent=e?"Сохранение...":t.dataset.buttonText},P=function(t,n){g.src=t,g.alt=n,x.textContent=n,e(C)};S.forEach((function(e){var n=function(e){return function(n){(n.target===n.currentTarget||n.target.classList.contains("popup__close"))&&t(e)}}(e);e.addEventListener("click",n)})),_.addEventListener("click",(function(){e(h)})),E.addEventListener("click",(function(){e(m),v.value=p.textContent,y.value=f.textContent})),q.addEventListener("submit",(function(e){var n,c;e.preventDefault(),D(!0,e.submitter),(n=v.value,c=y.value,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:n,about:c})}).then((function(e){return o(e)}))).then((function(e){p.textContent=e.name,f.textContent=e.about,t(m)})).catch((function(e){console.error(e)})).finally((function(){D(!1,e.submitter)}))})),k.addEventListener("click",(function(){return e(A)})),w.addEventListener("submit",(function(e){e.preventDefault(),D(!0,e.submitter);var n,c,s={name:T.value,link:U.value};(n=s.name,c=s.link,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:n,link:c})}).then((function(e){return o(e)}))).then((function(e){var n=i(e,a,u,P);L.prepend(n),t(A),w.reset()})).catch((function(e){console.error(e)})).finally((function(){D(!1,e.submitter)}))})),h.addEventListener("submit",(function(e){e.preventDefault();var n,c=b.value;D(!0,e.submitter),(n=c,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:n})}).then((function(e){return o(e)}))).then((function(e){_.style.backgroundImage="url('".concat(e.avatar,"')"),t(h)})).catch((function(e){console.error(e)})).finally((function(){D(!1,e.submitter)}))})),B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(B.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault(),d(B,e,e.querySelector(B.submitButtonSelector))})),d(B,e,e.querySelector(B.submitButtonSelector))}))})();